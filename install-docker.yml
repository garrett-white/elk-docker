---
- name: Install Docker
  hosts: 127.0.0.1
  connection: local
  gather_facts: no
  become: yes
  become_method: sudo

  tasks:

  - name: Ensure old versions of Docker are not installed.
    package:
      name:
        - docker
        - docker-engine
      state: absent

  - name: Ensure dependencies are installed.
    apt:
      name:
        - apt-transport-https
        - ca-certificates
        - curl
        - gnupg
        - lsb-release
      state: present
 
  - name: Add Docker GPG key.
    apt_key:
      key: https://download.docker.com/linux/debian/gpg
      state: present
  
  - name: Add Docker repository.
    apt_repository:
      repo: https://download.docker.com/linux/debian focal stable
      state: present
      update_cache: true

  - name: Install Docker packages.
    package:
      name: 
        - docker-ce
        - docker-ce-cli
        - containerd.io
        - docker-compose-plugin
      state: latest

  - name: Ensure Docker is started and enabled at boot.
    service:
      name: docker
      state: started
      enabled: true

